{"version":3,"file":"/vote.js","mappings":"ibACA,MAOMA,EAAW,IAPjB,QAOqBC,UACfC,EAAeC,QAAQC,IAAIC,aAuB3BC,EAAa,KAGf,IAAIC,EAAc,IAAIC,KAClBC,EAAS,IAAID,KAAKD,EAAYG,cAAc,EAAE,GAC9CC,EAAeC,KAAKC,OAAQN,EAAwBE,GAAkB,OACtEH,EAAaM,KAAKE,MAAOP,EAAYQ,SAAW,EAAIJ,GAAgB,GAKxE,OAJAK,QAAQC,IAAIV,EAAYQ,UACxBC,QAAQC,IAAIN,GACZK,QAAQC,IAAIR,GACZO,QAAQC,IAAIX,GACLA,GA0BE,EAAAY,QACXC,GACqC,OAAD,6BAClC,MAAMC,EAAcC,KAAKC,MAAMH,EAAMI,MAAQ,MAE/C,IAAIC,GAAW,EAvBO,IAACC,EA4BvB,OA5BuBA,EAyBHL,EAAMK,WArBJ,CAClB,CAAC,UAAW,UAAW,UAAW,WAClC,CAAC,SAAU,SAAU,SAAU,WALpBnB,IAQe,GAAGoB,SAASD,IAGrB,CAACE,IAEpB,MAAMC,GAWgD,IAAIpB,MAXpCqB,YACtB,OAAOD,GAAO,GAAKA,GAAO,GAUaE,KACvCN,GAAW,GAETA,QApEa,EAAOO,EAAeN,IAAqC,OAAD,6BAC3ET,QAAQC,IAAI,QACZ,MAAMe,EAAO1B,IAAa2B,WACpBC,GAiCJlB,QAAQC,KAAI,IAAIT,MAAOE,gBAChB,IAAIF,MAAOE,eAlCMuB,WACpBE,EAAa,gBAAgBjC,+BAClB6B,KAASC,KAAQE,qDAElBA,4BACKF,4BACAP,YAEnBT,QAAQC,IAAIkB,SACRnC,EACHoC,iBAAiB,CAChBC,UAAWF,IAEZG,UACAC,OAAOC,IACNxB,QAAQC,IAAIuB,SAoDRL,CAAWf,EAAMW,MAAOX,EAAMK,YAS/B,CACLgB,WAAY,IACZC,QAAS,CAAE,eAAgB,oBAC3BnB,KAAM,KAVC,CACHkB,WAAY,IACZC,QAAS,CAAE,eAAgB,oBAC3BnB,KAAM,Q,SCtFdoB,EAAOC,QAAUC,QAAQ,aCCrBC,EAA2B,GCE3BC,EDCJ,SAASC,EAAoBC,GAE5B,IAAIC,EAAeJ,EAAyBG,GAC5C,QAAqBE,IAAjBD,EACH,OAAOA,EAAaN,QAGrB,IAAID,EAASG,EAAyBG,GAAY,CAGjDL,QAAS,IAOV,OAHAQ,EAAoBH,GAAUI,KAAKV,EAAOC,QAASD,EAAQA,EAAOC,QAASI,GAGpEL,EAAOC,QClBWI,CAAoB,M","sources":["webpack://todo-package-name/./src/vote.ts","webpack://todo-package-name/external commonjs2 \"aws-sdk\"","webpack://todo-package-name/webpack/bootstrap","webpack://todo-package-name/webpack/startup"],"sourcesContent":["import {APIGatewayProxyEventV2,APIGatewayProxyHandlerV2,APIGatewayProxyResultV2} from \"aws-lambda\";\nimport { DynamoDB } from \"aws-sdk\";\n\ntype Vote = {\n  email: string;\n  programmer: string;\n};\n\nconst dynamoDB = new DynamoDB();\nconst voting_table = process.env.VOTING_TABLE ;\n\nconst insertVote = async (email: string, programmer: string): Promise<any> => {\n  console.log('here');\n  const week = weekNumber().toString();\n  const year = yearNumber().toString();\n  const insertVote = `INSERT INTO \"${voting_table}\" value \n      {'user' : '${email}#${week}#${year}',\n       'rec_type' : 'Vote',\n       'year' : ${year},\n       'weekNumber': ${week},\n      'programmer': '${programmer}'\n    }`;\n    console.log(insertVote);\n  await dynamoDB\n    .executeStatement({\n      Statement: insertVote,\n    })\n    .promise()\n    .catch((reason: any) => {\n      console.log(reason);\n    });\n};\nconst weekNumber = (): number => {\n    // Get Week Number\n    // Code referenced from https://www.delftstack.com/howto/javascript/javascript-get-week-number/\n    var currentdate = new Date();\n    var oneJan = new Date(currentdate.getFullYear(),0,1);\n    var numberOfDays = Math.floor(((currentdate as any)  - (oneJan as any)) / (24 * 60 * 60 * 1000));\n    var weekNumber = Math.ceil(( currentdate.getDay() + 1 + numberOfDays) / 7);\n    console.log(currentdate.getDay());\n    console.log(numberOfDays);\n    console.log(oneJan);\n    console.log(weekNumber);\n    return weekNumber;\n  };\n\n  const yearNumber = (): number => {\n    console.log(new Date().getFullYear());\n    return new Date().getFullYear();\n  };\n\nconst checkProgrammer = (programmer: string): boolean => {\n    var result = weekNumber();\n    \n    // For odd and even week let's have a different set of programmers\n    const programmers = [\n      [\"even_p1\", \"even_p2\", \"even_p3\", \"even_p4\"], // Even Week\n      [\"odd_p1\", \"odd_p2\", \"odd_p3\", \"odd_p4\"] // Odd Week\n    ];\n    // check if the programmer is in the weeks programmers list\n    return programmers[result % 2].includes(programmer);\n  };\n\nconst checkVotingDay = (timeStamp: Date): boolean => {\n    // Voting can happen on weekdays only\n    const day = timeStamp.getUTCDay();\n    return day >= 1 && day <= 5;\n  };\n  \nexport const handler: APIGatewayProxyHandlerV2 = async (\n  event: APIGatewayProxyEventV2\n): Promise<APIGatewayProxyResultV2> => {\n    const input: Vote = JSON.parse(event.body || \"{}\");\n\n  let validity = false;\n  // check if a programmer is due for voting and the time within stipulated voting time.\n  if (checkProgrammer(input.programmer) && checkVotingDay(new Date())) {\n    validity = true;\n  }\n  if (validity) {\n    // Insert into db\n    await insertVote(input.email, input.programmer);\n  } else{\n    return {\n        statusCode: 200,\n        headers: { \"Content-Type\": \"application/json\" },\n        body: \"\",\n      };\n  }\n\n  return {\n    statusCode: 200,\n    headers: { \"Content-Type\": \"application/json\" },\n    body: \"\",\n  };\n};","module.exports = require(\"aws-sdk\");","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// startup\n// Load entry module and return exports\n// This entry module is referenced by other modules so it can't be inlined\nvar __webpack_exports__ = __webpack_require__(4970);\n"],"names":["dynamoDB","DynamoDB","voting_table","process","env","VOTING_TABLE","weekNumber","currentdate","Date","oneJan","getFullYear","numberOfDays","Math","floor","ceil","getDay","console","log","handler","event","input","JSON","parse","body","validity","programmer","includes","timeStamp","day","getUTCDay","checkVotingDay","email","week","toString","year","insertVote","executeStatement","Statement","promise","catch","reason","statusCode","headers","module","exports","require","__webpack_module_cache__","__webpack_exports__","__webpack_require__","moduleId","cachedModule","undefined","__webpack_modules__","call"],"sourceRoot":""}